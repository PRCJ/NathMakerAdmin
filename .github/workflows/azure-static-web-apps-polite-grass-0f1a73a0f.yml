# üîç ENHANCED DEBUG: Copy built files with extensive debugging
      - name: Copy built files to deployment location
        run: |
          echo "=========================================="
          echo "üîç STARTING DEPLOYMENT FILE PREPARATION"
          echo "=========================================="
          
          echo "=== üìÅ INITIAL STATE CHECK ==="
          echo "Current working directory: $(pwd)"
          echo "Contents of current directory:"
          ls -la
          
          echo ""
          echo "=== üèóÔ∏è BUILD OUTPUT ANALYSIS ==="
          echo "Checking frontend/build structure:"
          if [ -d "frontend/build" ]; then
            find frontend/build -type f -name "*.js" -o -name "*.html" -o -name "*.css" | sort
            echo ""
            echo "All files in frontend/build:"
            find frontend/build -type f | head -20
            echo ""
            echo "Directory structure:"
            ls -la frontend/build/
            if [ -d "frontend/build/distributions" ]; then
              echo ""
              echo "Contents of distributions:"
              ls -la frontend/build/distributions/
              echo ""
              echo "Recursive listing of distributions:"
              find frontend/build/distributions -type f -exec ls -la {} \;
            fi
          else
            echo "‚ùå frontend/build directory not found!"
          fi

          echo ""
          echo "=== üöÄ CREATING DEPLOYMENT DIRECTORY ==="
          rm -rf ./deploy
          mkdir -p ./deploy
          echo "‚úÖ Deploy directory created"

          echo ""
          echo "=== üìã COPYING FILES ==="
          echo "Attempting to copy from frontend/build/distributions to ./deploy"
          
          if [ -d "frontend/build/distributions" ]; then
            echo "‚úÖ Source directory exists, copying..."
            rsync -av frontend/build/distributions/ ./deploy/ || {
              echo "‚ö†Ô∏è rsync failed, trying cp..."
              cp -r frontend/build/distributions/* ./deploy/ 2>/dev/null || {
                echo "‚ùå Both rsync and cp failed!"
                echo "Trying alternative copy methods..."
                for file in frontend/build/distributions/*; do
                  if [ -e "$file" ]; then
                    cp -r "$file" ./deploy/ || echo "Failed to copy: $file"
                  fi
                done
              }
            }
            echo "Copy operation completed"
          else
            echo "‚ùå Source directory frontend/build/distributions does not exist!"
          fi

          echo ""
          echo "=== üìÇ POST-COPY ANALYSIS ==="
          echo "Contents of deploy directory after copy:"
          ls -la ./deploy/ || echo "‚ùå Cannot list deploy directory"
          
          echo ""
          echo "All files in deploy (recursive):"
          find ./deploy -type f -exec ls -la {} \; 2>/dev/null || echo "‚ùå Cannot find files in deploy"

          echo ""
          echo "=== üóÇÔ∏è HANDLING COMPOSE RESOURCES ==="
          if [ -d "./deploy/composeResources" ]; then
            echo "‚úÖ composeResources directory found"
            echo "Contents of composeResources:"
            ls -la ./deploy/composeResources/
            echo ""
            echo "Files in composeResources:"
            find ./deploy/composeResources -type f -exec ls -la {} \;
            echo ""
            echo "Copying composeResources contents to deploy root..."
            cp -r ./deploy/composeResources/* ./deploy/ 2>/dev/null && echo "‚úÖ Copy successful" || echo "‚ö†Ô∏è Copy had issues"
          else
            echo "‚ÑπÔ∏è No composeResources directory found"
          fi

          echo ""
          echo "=== üîç JAVASCRIPT FILE DETECTION ==="
          echo "Searching for .js files in deploy directory..."
          
          # Method 1: Simple find
          echo "Method 1 - Simple find:"
          find ./deploy -name "*.js" -type f 2>/dev/null || echo "No JS files found with simple find"
          
          echo ""
          echo "Method 2 - Find with details:"
          js_files_raw=$(find ./deploy -name "*.js" -type f 2>/dev/null)
          if [ -n "$js_files_raw" ]; then
            echo "Raw JS files found:"
            echo "$js_files_raw"
            echo ""
            echo "Details of each JS file:"
            echo "$js_files_raw" | while read -r file; do
              if [ -f "$file" ]; then
                echo "üìÑ $file - Size: $(stat -c%s "$file" 2>/dev/null || echo 'unknown') bytes"
              fi
            done
          else
            echo "‚ùå No JS files found"
          fi
          
          echo ""
          echo "Method 3 - Filter out map files:"
          js_files_filtered=""
          if [ -n "$js_files_raw" ]; then
            js_files_filtered=$(echo "$js_files_raw" | grep -v ".map" || true)
            if [ -n "$js_files_filtered" ]; then
              echo "‚úÖ JS files after filtering .map files:"
              echo "$js_files_filtered"
            else
              echo "‚ö†Ô∏è All JS files were .map files or filtering failed"
            fi
          fi

          echo ""
          echo "=== üéØ SELECTING JS FILE ==="
          js_filename="app.js"  # Default fallback
          
          if [ -n "$js_files_filtered" ] && [ "$js_files_filtered" != "" ]; then
            echo "‚úÖ JS files available for selection"
            
            # Look for main file
            main_js=$(echo "$js_files_filtered" | grep -i "main" | head -1 || true)
            if [ -n "$main_js" ] && [ "$main_js" != "" ]; then
              js_filename=$(basename "$main_js")
              echo "üéØ Selected MAIN JS file: $js_filename"
              echo "üìç Full path: $main_js"
            else
              # Use first available
              first_js=$(echo "$js_files_filtered" | head -1)
              if [ -n "$first_js" ]; then
                js_filename=$(basename "$first_js")
                echo "üéØ Selected FIRST JS file: $js_filename"
                echo "üìç Full path: $first_js"
              fi
            fi
          else
            echo "‚ö†Ô∏è No suitable JS files found, checking original build..."
            
            # Fallback to original build directory
            original_js=$(find frontend/build -name "*.js" -type f 2>/dev/null | grep -v ".map" | head -1 || true)
            if [ -n "$original_js" ] && [ -f "$original_js" ]; then
              echo "‚úÖ Found JS in original build: $original_js"
              cp "$original_js" ./deploy/
              js_filename=$(basename "$original_js")
              echo "üìã Copied to deploy: $js_filename"
            else
              echo "‚ùå No JS files found anywhere! Using fallback: $js_filename"
            fi
          fi
          
          echo ""
          echo "üèÜ FINAL SELECTED JS FILE: $js_filename"

          echo ""
          echo "=== üìù CREATING INDEX.HTML ==="
          cat > ./deploy/index.html <<EOF
          <!DOCTYPE html>
          <html lang="en">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>NathMaker Admin</title>
          </head>
          <body>
              <div id="root"></div>
              <script src="./$js_filename"></script>
          </body>
          </html>
          EOF
          
          if [ -f "./deploy/index.html" ]; then
            echo "‚úÖ index.html created successfully"
            echo "üìÑ File size: $(stat -c%s "./deploy/index.html" 2>/dev/null || echo 'unknown') bytes"
            echo ""
            echo "üìã Content of index.html:"
            cat ./deploy/index.html
          else
            echo "‚ùå Failed to create index.html"
            exit 1
          fi

          echo ""
          echo "=== üîç FINAL VERIFICATION ==="
          echo "üìÅ Final contents of deploy directory:"
          ls -la ./deploy/ || echo "‚ùå Cannot list deploy directory"
          
          echo ""
          echo "üìä File count and sizes:"
          total_files=$(find ./deploy -type f 2>/dev/null | wc -l)
          echo "Total files: $total_files"
          
          if [ "$total_files" -gt 0 ]; then
            echo ""
            echo "üìã All files with sizes:"
            find ./deploy -type f -exec ls -lh {} \; | sort
            
            echo ""
            echo "üîç Checking if our key files exist:"
            if [ -f "./deploy/index.html" ]; then
              echo "‚úÖ index.html exists"
            else
              echo "‚ùå index.html missing!"
            fi
            
            if [ -f "./deploy/$js_filename" ]; then
              echo "‚úÖ JS file ($js_filename) exists"
            else
              echo "‚ùå JS file ($js_filename) missing!"
              echo "üîç Available JS files in deploy:"
              find ./deploy -name "*.js" -type f || echo "None found"
            fi
          else
            echo "‚ùå No files in deploy directory!"
            exit 1
          fi

          echo ""
          echo "=========================================="
          echo "‚úÖ DEPLOYMENT PREPARATION COMPLETED"
          echo "üéØ JS File: $js_filename"
          echo "üìÅ Total Files: $total_files"
          echo "=========================================="
